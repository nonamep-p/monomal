#!/bin/bash

THEME_DIR="$HOME/.config/neofetch/themes"
CONFIG_FILE="$HOME/.config/neofetch/config.conf"

# Ensure themes exist
if [ ! -d "$THEME_DIR" ]; then
    echo "Themes directory not found!"
    exit 1
fi

# Select with fzf and preview
SELECTED=$(find "$THEME_DIR" -name "*.conf" | fzf \
    --prompt="Select Theme > " \
    --height=100% \
    --layout=reverse \
    --border \
    --preview "neofetch --config {}" \
    --preview-window=right:70% \
    --delimiter / \
    --with-nth -1)

if [ -n "$SELECTED" ]; then
    echo "Applying: $SELECTED"
    cp "$SELECTED" "$CONFIG_FILE"
    
    # Verify copy
    if [ $? -eq 0 ]; then
        echo -e "\n\033[1;32m✔ Theme applied successfully!\033[0m"
        echo "Running preview..."
        neofetch
    else
        echo -e "\n\033[1;31m✖ Failed to apply theme.\033[0m"
    fi
else
    echo "No theme selected."
fi